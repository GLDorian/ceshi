<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DocuGen Pro | 临床文档专家</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #f1f5f9; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      
      #loading-screen {
        position: fixed; inset: 0; background: white;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        z-index: 9999; transition: all 0.3s ease;
      }
      .spinner {
        width: 40px; height: 40px; border: 4px solid #f3f3f3;
        border-top: 4px solid #3b82f6; border-radius: 50%;
        animation: spin 1s linear infinite; margin-bottom: 16px;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .fade-out { opacity: 0; pointer-events: none; }
    </style>

    <script>
      // 预设环境
      window.process = { env: { API_KEY: "" } };
      
      // 全局加载控制
      window.hideAppLoader = function() {
        const loader = document.getElementById('loading-screen');
        if (loader) loader.classList.add('fade-out');
      };

      // 实时错误诊断
      window.onerror = function(msg, url, line) {
        const errorMsg = document.getElementById('error-details');
        if (errorMsg) {
          errorMsg.innerHTML = `错误详情: ${msg}<br>文件: ${url.split('/').pop()}<br>行号: ${line}`;
          document.getElementById('error-guide').classList.remove('hidden');
          document.getElementById('status-msg').innerText = "启动过程中发生错误";
        }
      };
    </script>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "@google/genai": "https://esm.sh/@google/genai@1.31.0",
    "lucide-react": "https://esm.sh/lucide-react@0.468.0",
    "xlsx": "https://esm.sh/xlsx@0.18.5",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-slate-50">
    <div id="loading-screen">
      <div class="spinner"></div>
      <div class="text-blue-600 font-bold text-xl mb-2">DocuGen Pro</div>
      <div id="status-msg" class="text-slate-400 text-sm">正在加载组件 (首次加载可能需要10秒)...</div>
      
      <div id="error-guide" class="hidden mt-8 p-6 bg-red-50 border border-red-200 rounded-xl max-w-lg mx-4">
        <div class="font-bold text-red-800 mb-2">加载失败诊断</div>
        <p id="error-details" class="text-red-700 text-xs font-mono mb-4 break-all bg-white p-2 rounded border border-red-100"></p>
        <button onclick="location.reload()" class="w-full py-2 bg-red-600 text-white rounded-lg text-xs font-bold shadow-lg">尝试刷新页面</button>
      </div>
    </div>
    
    <div id="root"></div>

    <!-- 修复入口：Babel 处理整个依赖链 -->
    <script type="text/babel" data-type="module">
      import './index.tsx';
    </script>

    <script>
      // 12秒超时自动显示诊断信息
      setTimeout(() => {
        const loader = document.getElementById('loading-screen');
        if (loader && !loader.classList.contains('fade-out')) {
          document.getElementById('error-guide').classList.remove('hidden');
        }
      }, 12000);
    </script>
  </body>
</html>